# 実装計画

- [x] 1. プロジェクト基盤とインフラストラクチャの構築

  - プロジェクトのディレクトリ構造を作成し、Rust ワークスペースとフロントエンドの基本設定を行う
  - SAM テンプレートで DynamoDB、API Gateway、Cognito、CloudWatch の基本リソースを定義する
  - GitHub Actions ワークフローファイルを作成し、CI/CD パイプラインの基盤を構築する
  - _要件: 8.1, 8.2, 8.3, 8.4_

- [ ] 2. 共通ドメインモデルとイベント定義の実装

  - [x] 2.1 ULID ベースの TodoId 型を実装

    - ULID ライブラリを使用して TodoId 構造体を作成する
    - タイムスタンプ抽出、文字列変換、バリデーション機能を実装する
    - TodoId のユニットテストを作成する
    - _要件: 1.1, 2.2_

  - [x] 2.2 TodoEvent 列挙型とイベントスキーマを実装

    - TodoCreatedV2、TodoUpdatedV1、TodoCompletedV1、TodoDeletedV1 イベントを定義する
    - Serde を使用した JSON シリアライゼーション/デシリアライゼーションを実装する
    - イベントバージョニングとアップキャスト機能を実装する
    - _要件: 2.1, 2.2_

  - [ ] 2.3 Todo アグリゲートとイベント適用ロジックを実装
    - Todo 構造体と apply メソッドを実装する
    - 各イベントタイプに対する状態変更ロジックを実装する
    - アグリゲートのユニットテストを作成する
    - _要件: 1.1, 1.2, 2.1_

- [ ] 3. DynamoDB アクセス層の実装

  - [ ] 3.1 DynamoDB クライアントとコネクション管理を実装

    - AWS SDK for Rust を使用した DynamoDB クライアントを作成する
    - コネクションプールとエラーハンドリングを実装する
    - 設定管理とテスト用モックを作成する
    - _要件: 2.3, 5.3_

  - [ ] 3.2 Single Table Design に基づくリポジトリパターンを実装

    - EventRepository でイベントの保存・取得機能を実装する
    - ProjectionRepository で現在状態の管理機能を実装する
    - SnapshotRepository でスナップショット管理機能を実装する
    - _要件: 2.1, 2.4_

  - [ ] 3.3 楽観的ロックとリトライ機能を実装
    - バージョン番号による楽観的ロック機能を実装する
    - 同時実行制御とリトライロジックを実装する
    - 楽観的ロックの統合テストを作成する
    - _要件: 1.2, 5.2_

- [ ] 4. Lambda 関数の実装

  - [ ] 4.1 CommandHandler Lambda 関数を実装

    - API Gateway イベントのパースとルーティングを実装する
    - ToDo 作成、更新、完了、削除コマンドの処理を実装する
    - JWT トークンからユーザー情報を抽出する機能を実装する
    - _要件: 1.1, 1.2, 1.3, 1.4_

  - [ ] 4.2 QueryHandler Lambda 関数を実装

    - ToDo 一覧取得（アクティブ・全件）機能を実装する
    - ToDo 詳細取得機能を実装する
    - ToDo 履歴取得機能を実装する
    - _要件: 1.1, 2.1_

  - [ ] 4.3 EventProcessor Lambda 関数を実装

    - DynamoDB Streams イベントの処理を実装する
    - イベントからプロジェクションの更新を実装する
    - エラーハンドリングと DLQ 送信機能を実装する
    - _要件: 2.3, 2.5_

  - [ ] 4.4 SnapshotManager Lambda 関数を実装
    - 定期的なスナップショット作成ロジックを実装する
    - 古いスナップショットの TTL 設定機能を実装する
    - EventBridge による定期実行の設定を実装する
    - _要件: 2.4_

- [ ] 5. 認証・認可システムの実装

  - [ ] 5.1 Cognito ユーザープールと Passkey 認証を設定

    - Cognito ユーザープールとアプリクライアントを作成する
    - WebAuthn（Passkey）認証の設定を行う
    - 家族グループとロールベースアクセス制御を設定する
    - _要件: 4.1, 4.2, 3.3_

  - [ ] 5.2 JWT トークン検証と API Gateway 認証を実装

    - API Gateway での JWT 検証設定を行う
    - Lambda Authorizer による追加認証ロジックを実装する
    - トークンリフレッシュ機能を実装する
    - _要件: 4.3, 4.4_

  - [ ] 5.3 家族メンバー管理機能を実装
    - 家族メンバー招待機能を実装する
    - 招待トークンの生成と検証を実装する
    - SES による招待メール送信機能を実装する
    - _要件: 3.1, 3.2, 3.4_

- [ ] 6. エラーハンドリングと監視機能の実装

  - [ ] 6.1 包括的なエラーハンドリングシステムを実装

    - カスタムエラー型とエラー分類を実装する
    - リトライ可能エラーの判定とリトライロジックを実装する
    - エラーレスポンスの標準化を実装する
    - _要件: 2.5, 5.4_

  - [ ] 6.2 OpenTelemetry による分散トレーシングを実装

    - OpenTelemetry SDK の設定とトレーサー初期化を実装する
    - Lambda 関数でのトレーシング計装を実装する
    - X-Ray との統合設定を実装する
    - _要件: 7.1, 7.3_

  - [ ] 6.3 CloudWatch アラームとメトリクス監視を実装
    - パフォーマンスメトリクスの監視設定を実装する
    - エラー率とレイテンシのアラーム設定を実装する
    - カスタムメトリクスの送信機能を実装する
    - _要件: 7.2, 7.4, 5.1, 5.3, 5.4, 5.5_

- [ ] 7. フロントエンド基盤の実装

  - [ ] 7.1 React + TypeScript + Vite プロジェクトを構築

    - Vite を使用した React プロジェクトを作成する
    - TypeScript 設定と型定義を実装する
    - Biome による コードフォーマットとリント設定を行う
    - _要件: 8.1_

  - [ ] 7.2 API クライアントと認証機能を実装

    - REST API クライアントライブラリを実装する
    - Cognito SDK を使用した認証フローを実装する
    - JWT トークン管理とリフレッシュ機能を実装する
    - _要件: 4.1, 4.3, 4.4_

  - [ ] 7.3 基本的な ToDo 管理 UI を実装
    - ToDo 一覧表示コンポーネントを実装する
    - ToDo 作成・編集フォームを実装する
    - ToDo 完了・削除機能を実装する
    - _要件: 1.1, 1.2, 1.3, 1.4_

- [ ] 8. データ保護と GDPR 対応機能の実装

  - [ ] 8.1 論理削除と物理削除機能を実装

    - 通常の論理削除（Soft Delete）機能を実装する
    - GDPR 要求による物理削除（Hard Delete）機能を実装する
    - 削除操作の監査ログ機能を実装する
    - _要件: 6.1, 6.2, 6.3, 6.4_

  - [ ] 8.2 データ削除の統合テストを実装
    - 論理削除のテストケースを作成する
    - 物理削除の完全性テストを作成する
    - 削除後のデータアクセステストを作成する
    - _要件: 6.5_

- [ ] 9. 統合テストと E2E テストの実装

  - [ ] 9.1 Lambda 関数の統合テストを実装

    - CommandHandler の統合テストを作成する
    - QueryHandler の統合テストを作成する
    - EventProcessor の統合テストを作成する
    - _要件: 1.1, 1.2, 1.3, 1.4, 2.1, 2.3_

  - [ ] 9.2 API エンドポイントの E2E テストを実装

    - ToDo ライフサイクル全体の E2E テストを作成する
    - 認証フローの E2E テストを作成する
    - エラーケースの E2E テストを作成する
    - _要件: 1.1, 1.2, 1.3, 1.4, 4.1, 4.2, 4.3, 4.4_

  - [ ] 9.3 パフォーマンステストを実装
    - K6 を使用した負荷テストスクリプトを作成する
    - レスポンスタイム要件の検証テストを実装する
    - 同時実行性能のテストを実装する
    - _要件: 5.1, 5.2, 5.3, 5.4, 5.5_

- [ ] 10. デプロイメントとインフラ最適化

  - [ ] 10.1 本番環境用 SAM テンプレートを完成

    - 本番環境用のリソース設定を実装する
    - セキュリティ設定と IAM ロールを最適化する
    - コスト最適化設定を実装する
    - _要件: 8.2, 8.4_

  - [ ] 10.2 CI/CD パイプラインを完成

    - 自動テスト実行の設定を完成する
    - 自動デプロイメントの設定を完成する
    - ロールバック機能を実装する
    - _要件: 8.1, 8.3, 8.5_

  - [ ] 10.3 監視とアラートシステムを完成
    - 本番環境用の監視設定を実装する
    - アラート通知システムを設定する
    - ダッシュボードとレポート機能を実装する
    - _要件: 7.2, 7.4, 7.5_
